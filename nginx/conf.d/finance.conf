upstream finance_management_web {
  # Match this name/port combo with the Docker Compose service and exposed container port.
  server finance-management-web:3000;
}

server {
  listen 80;
  listen [::]:80;
  server_name finance.example.com example.com; # Replace with your real subdomains.


  # Allow ACME HTTP-01 challenges for certificate issuance. Certbot writes challenges into ./www.
  location /.well-known/acme-challenge/ {
    root /var/www/html;
  }

  client_max_body_size 10M;

  location / {
    proxy_pass http://finance_management_web;
    include /etc/nginx/proxy_params;

    # Timeout settings
    proxy_read_timeout 300s;
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
  }

  # Uncomment the redirect below once certificates exist under ./letsencrypt/live/<domain>/
  # return 301 https://$host$request_uri;
}

# Example HTTPS block (commented out until certificates exist)
# server {
#   listen 443 ssl http2;
#   listen [::]:443 ssl http2;
#   server_name finance.example.com example.com; # Match the HTTP block hostnames
#
#   ssl_certificate     /etc/letsencrypt/live/finance.example.com/fullchain.pem;
#   ssl_certificate_key /etc/letsencrypt/live/finance.example.com/privkey.pem;
#   include /etc/letsencrypt/options-ssl-nginx.conf; # Provided by Certbot
#   ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
#
#   # Allow ACME HTTP-01 challenges on HTTPS as well
#   location /.well-known/acme-challenge/ {
#     root /var/www/html;
#   }
#
#   client_max_body_size 10M; # Keep body size consistent with the HTTP server block
#
#   location / {
#     proxy_pass http://finance_management_web;
#     include /etc/nginx/proxy_params;
#   }
# }
